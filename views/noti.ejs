<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="/stylesheets/noti.css">
    
        
</head>
<body>
   
    <div class="landing-page">
        <header>
            <div class="container">

                <a href="/profile" class="logo">KARZA</a>
        
                <ul class="links">
                    <li><a href="/profile"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M21 8.77217L14.0208 1.79299C12.8492 0.621414 10.9497 0.621413 9.77817 1.79299L3 8.57116V23.0858H10V17.0858C10 15.9812 10.8954 15.0858 12 15.0858C13.1046 15.0858 14 15.9812 14 17.0858V23.0858H21V8.77217ZM11.1924 3.2072L5 9.39959V21.0858H8V17.0858C8 14.8767 9.79086 13.0858 12 13.0858C14.2091 13.0858 16 14.8767 16 17.0858V21.0858H19V9.6006L12.6066 3.2072C12.2161 2.81668 11.5829 2.81668 11.1924 3.2072Z" fill="currentColor" /></svg></a></li>
                    <li><a href="/history"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.364 13.1214C15.2876 14.045 15.4831 15.4211 14.9504 16.5362L16.4853 18.0711C16.8758 18.4616 16.8758 19.0948 16.4853 19.4853C16.0948 19.8758 15.4616 19.8758 15.0711 19.4853L13.5361 17.9504C12.421 18.4831 11.045 18.2876 10.1213 17.364C8.94975 16.1924 8.94975 14.2929 10.1213 13.1214C11.2929 11.9498 13.1924 11.9498 14.364 13.1214ZM12.9497 15.9498C13.3403 15.5593 13.3403 14.9261 12.9497 14.5356C12.5592 14.145 11.9261 14.145 11.5355 14.5356C11.145 14.9261 11.145 15.5593 11.5355 15.9498C11.9261 16.3403 12.5592 16.3403 12.9497 15.9498Z" fill="currentColor" /><path d="M8 5H16V7H8V5Z" fill="currentColor" /><path d="M16 9H8V11H16V9Z" fill="currentColor" /><path fill-rule="evenodd" clip-rule="evenodd" d="M4 4C4 2.34315 5.34315 1 7 1H17C18.6569 1 20 2.34315 20 4V20C20 21.6569 18.6569 23 17 23H7C5.34315 23 4 21.6569 4 20V4ZM7 3H17C17.5523 3 18 3.44772 18 4V20C18 20.5523 17.5523 21 17 21H7C6.44772 21 6 20.5523 6 20V4C6 3.44772 6.44771 3 7 3Z" fill="currentColor" /></svg></a></li>
                   
                    <li>
                        <div class="icon-wrapper">
                          <a href="/noti">
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                              <path fill-rule="evenodd" clip-rule="evenodd" d="M14 3V3.28988C16.8915 4.15043 19 6.82898 19 10V17H20V19H4V17H5V10C5 6.82898 7.10851 4.15043 10 3.28988V3C10 1.89543 10.8954 1 12 1C13.1046 1 14 1.89543 14 3ZM7 17H17V10C17 7.23858 14.7614 5 12 5C9.23858 5 7 7.23858 7 10V17ZM14 21V20H10V21C10 22.1046 10.8954 23 12 23C13.1046 23 14 22.1046 14 21Z" fill="currentColor"/>
                            </svg>
                          </a>
                          <% if (hasNewNotifications) { %>
                            <div class="noti"></div>
                          <% } %>
                        </div>
                      </li>
                    
                    
                      <li><a href="/logout"><svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.51428 20H4.51428C3.40971 20 2.51428 19.1046 2.51428 18V6C2.51428 4.89543 3.40971 4 4.51428 4H8.51428V6H4.51428V18H8.51428V20Z" fill="currentColor" /><path d="M13.8418 17.385L15.262 15.9768L11.3428 12.0242L20.4857 12.0242C21.038 12.0242 21.4857 11.5765 21.4857 11.0242C21.4857 10.4719 21.038 10.0242 20.4857 10.0242L11.3236 10.0242L15.304 6.0774L13.8958 4.6572L7.5049 10.9941L13.8418 17.385Z" fill="currentColor" /></svg></a></li>
                </ul>
            </div>
        </header>

        <div class="panel">

            <h1>Pending Loan Requests</h1>
            <div class="line"></div>
            <% user.loan.reverse().forEach((element, index) => { %>
                <div class="req">
                    <div class="card">
                        <img class="cardimg" src="/images/<%=element.lenderdp %>" alt="" srcset="">
                    </div>
                    <p id="name"><%= element.lendername %> has sent you a loan of rupees <%= element.amount %></p>
                   
                    <a href="#" data-id="<%= element._id %>" class="tick accept-loan" style="color: white;">&#10003;</a>

                    <a href="/deletenoti/<%=element._id  %>" class="wrong reject-loan" style="margin-left: 60px; color: white;">&#10006</a>
                </div>
            <% }); %>
            
            

        </div>

        

    

    <div class="bg-text-stroke">
        <span>Karza</span>
    </div>
   
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const acceptButtons = document.querySelectorAll('.accept-loan');
            const rejectButtons = document.querySelectorAll('.reject-loan');
        
            acceptButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.preventDefault(); 
                    const loanId = this.getAttribute('data-id');
                    fetch(`/accept-loan/${loanId}`, { method: 'GET' }) 
                        .then(response => {
                            if (response.ok) {
                                this.closest('.req').remove(); 
                            }
                        })
                        .catch(error => console.error('Error:', error));
                });
            });
        
            
    
    rejectButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault(); // Prevent default action of the link
            const loanId = this.href.split('/').pop(); // Get the loan ID from the href
            fetch(`/deletenoti/${loanId}`, { method: 'GET' })
                .then(response => {
                    if (response.ok) {
                        this.closest('.req').remove(); // Remove the div if the server successfully deletes the loan
                    } else {
                        console.error('Failed to delete the loan on the server.');
                    }
                })
                .catch(error => console.error('Error:', error));
        });
    });
        });
        </script>
        
</body>
</html>
